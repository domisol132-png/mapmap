import streamlit as st
import pandas as pd
import requests 
import datetime
import calendar
import folium # ğŸŒŸ ì§€ë„ ê·¸ë¦¬ëŠ” ë¶“
from streamlit_folium import st_folium # ğŸŒŸ ê·¸ë¦° ì§€ë„ë¥¼ ì›¹ì— ë„ì›Œì£¼ëŠ” ì•¡ì

# 1. í˜ì´ì§€ ì„¤ì •
st.set_page_config(page_title="í•©ì£¼ì‹¤ ë§µìŠ¤ìºë„ˆ", page_icon="ğŸ¸", layout="wide")

# ==========================================
# ğŸ—‚ï¸ ë¬´ì ì˜ í•©ì£¼ì‹¤ ë°ì´í„°ë² ì´ìŠ¤ (ìœ„ë„/ê²½ë„ ì¢Œí‘œ ì¶”ê°€!)
# ==========================================
STUDIO_DB = {
    "ê·¸ë¼ìš´ë“œí•©ì£¼ì‹¤ ë³¸ì ": [
        {"name": "ê·¸ë¼ìš´ë“œ ë³¸ì  Së£¸", "url": "https://m.booking.naver.com/booking/10/bizes/1061592/items/5587861", "lat": 37.5561, "lon": 126.9234},
        {"name": "ê·¸ë¼ìš´ë“œ ë³¸ì  A1ë£¸", "url": "https://m.booking.naver.com/booking/10/bizes/1061592/items/5588402", "lat": 37.5561, "lon": 126.9234},
        {"name": "ê·¸ë¼ìš´ë“œ ë³¸ì  A2ë£¸", "url": "https://m.booking.naver.com/booking/10/bizes/1061592/items/5588476", "lat": 37.5561, "lon": 126.9234},
        {"name": "ê·¸ë¼ìš´ë“œ ë³¸ì  A3ë£¸", "url": "https://m.booking.naver.com/booking/10/bizes/1061592/items/5588707", "lat": 37.5561, "lon": 126.9234},
        {"name": "ê·¸ë¼ìš´ë“œ ë³¸ì  B1ë£¸", "url": "https://m.booking.naver.com/booking/10/bizes/1061592/items/5588783", "lat": 37.5561, "lon": 126.9234},
        {"name": "ê·¸ë¼ìš´ë“œ ë³¸ì  B2ë£¸", "url": "https://m.booking.naver.com/booking/10/bizes/1061592/items/5588817", "lat": 37.5561, "lon": 126.9234},
        {"name": "ê·¸ë¼ìš´ë“œ ë³¸ì  Cë£¸", "url": "https://m.booking.naver.com/booking/10/bizes/1061592/items/5588835", "lat": 37.5561, "lon": 126.9234},
        {"name": "ê·¸ë¼ìš´ë“œ ë³¸ì  Dë£¸", "url": "https://m.booking.naver.com/booking/10/bizes/1061592/items/5588869", "lat": 37.5561, "lon": 126.9234},
        {"name": "ê·¸ë¼ìš´ë“œ ë³¸ì  Eë£¸", "url": "https://m.booking.naver.com/booking/10/bizes/1061592/items/5588887", "lat": 37.5561, "lon": 126.9234}
    ],
    "ê·¸ë¼ìš´ë“œí•©ì£¼ì‹¤ í™ëŒ€1í˜¸ì ": [
        {"name": "ê·¸ë¼ìš´ë“œ í™ëŒ€1í˜¸ì  Së£¸", "url": "https://m.booking.naver.com/booking/10/bizes/329314/items/6651547", "lat": 37.557207, "lon": 126.922592},
        {"name": "ê·¸ë¼ìš´ë“œ í™ëŒ€1í˜¸ì  Aë£¸", "url": "https://m.booking.naver.com/booking/10/bizes/329314/items/6651549", "lat": 37.557207, "lon": 126.922592},
        {"name": "ê·¸ë¼ìš´ë“œ í™ëŒ€1í˜¸ì  Bë£¸", "url": "https://m.booking.naver.com/booking/10/bizes/329314/items/6651550", "lat": 37.557207, "lon": 126.922592},
        {"name": "ê·¸ë¼ìš´ë“œ í™ëŒ€1í˜¸ì  Cë£¸", "url": "https://m.booking.naver.com/booking/10/bizes/329314/items/6651551", "lat": 37.557207, "lon": 126.922592},
        {"name": "ê·¸ë¼ìš´ë“œ í™ëŒ€1í˜¸ì  Dë£¸", "url": "https://m.booking.naver.com/booking/10/bizes/329314/items/6651554", "lat": 37.557207, "lon": 126.922592},
        {"name": "ê·¸ë¼ìš´ë“œ í™ëŒ€1í˜¸ì  Eë£¸", "url": "https://m.booking.naver.com/booking/10/bizes/329314/items/6646547", "lat": 37.557207, "lon": 126.922592}
    ],
    "ê·¸ë¼ìš´ë“œí•©ì£¼ì‹¤ í•©ì •1í˜¸ì ": [
        {"name": "ê·¸ë¼ìš´ë“œ í•©ì •1í˜¸ì  Së£¸", "url": "https://m.booking.naver.com/booking/10/bizes/331813/items/3361583", "lat": 37.550460, "lon": 126.919062},
        {"name": "ê·¸ë¼ìš´ë“œ í•©ì •1í˜¸ì  Aë£¸", "url": "https://m.booking.naver.com/booking/10/bizes/331813/items/3361594", "lat": 37.550460, "lon": 126.919062},
        {"name": "ê·¸ë¼ìš´ë“œ í•©ì •1í˜¸ì  Bë£¸", "url": "https://m.booking.naver.com/booking/10/bizes/331813/items/3361595", "lat": 37.550460, "lon": 126.919062},
        {"name": "ê·¸ë¼ìš´ë“œ í•©ì •1í˜¸ì  Cë£¸", "url": "https://m.booking.naver.com/booking/10/bizes/331813/items/3361597", "lat": 37.550460, "lon": 126.919062}
    ],
    "ê·¸ë¼ìš´ë“œí•©ì£¼ì‹¤ ì‹ ì´Œ1í˜¸ì ": [
        {"name": "ê·¸ë¼ìš´ë“œ ì‹ ì´Œ1í˜¸ì  Së£¸", "url": "https://m.booking.naver.com/booking/10/bizes/1182602/items/5979437", "lat": 37.556237, "lon": 126.940985},
        {"name": "ê·¸ë¼ìš´ë“œ ì‹ ì´Œ1í˜¸ì  Aë£¸", "url": "https://m.booking.naver.com/booking/10/bizes/1182602/items/5979448", "lat": 37.556237, "lon": 126.940985},
        {"name": "ê·¸ë¼ìš´ë“œ ì‹ ì´Œ1í˜¸ì  Bë£¸", "url": "https://m.booking.naver.com/booking/10/bizes/1182602/items/5979471", "lat": 37.556237, "lon": 126.940985},
        {"name": "ê·¸ë¼ìš´ë“œ ì‹ ì´Œ1í˜¸ì  Cë£¸", "url": "https://m.booking.naver.com/booking/10/bizes/1182602/items/5979479", "lat": 37.556237, "lon": 126.940985}
    ],
    "ì œì‹œë®¤ì§ í•©ì£¼ì‹¤ í™ëŒ€ì ": [
        {"name": "ì œì‹œë®¤ì§ í™ëŒ€ì  Rë£¸", "url": "https://m.booking.naver.com/booking/10/bizes/446860/items/4013506", "lat": 37.555284, "lon": 126.920221},
        {"name": "ì œì‹œë®¤ì§ í™ëŒ€ì  Aë£¸", "url": "https://m.booking.naver.com/booking/10/bizes/446860/items/3702602", "lat": 37.555284, "lon": 126.920221},
        {"name": "ì œì‹œë®¤ì§ í™ëŒ€ì  Bë£¸", "url": "https://m.booking.naver.com/booking/10/bizes/446860/items/3702645", "lat": 37.555284, "lon": 126.920221}
    ],
    "í˜¸ë‘ì´í•©ì£¼ì‹¤": [
        {"name": "í˜¸ë‘ì´ 1", "url": "https://m.booking.naver.com/booking/10/bizes/1062791/items/5592935", "lat": 37.5575, "lon": 126.9255},
        {"name": "í˜¸ë‘ì´ 2", "url": "https://m.booking.naver.com/booking/10/bizes/1062791/items/5606830", "lat": 37.5575, "lon": 126.9255},
        {"name": "í˜¸ë‘ì´ 3", "url": "https://m.booking.naver.com/booking/10/bizes/1062791/items/5606836", "lat": 37.5575, "lon": 126.9255}
    ]
}

# â±ï¸ ì‹œê°„ ë³€í™˜ í•¨ìˆ˜
def convert_to_24h_set(time_string):
    if not time_string or str(time_string) == 'nan' or time_string == "-": return set()
    times = [t.strip() for t in time_string.split(',')]
    result_set = set()
    for t in times:
        current_period = "ì˜¤í›„" if "ì˜¤í›„" in t else "ì˜¤ì „"
        try: 
            hour_str = t.replace("ì˜¤ì „", "").replace("ì˜¤í›„", "").replace("ì‹œ", "").split(":")[0].strip()
            hour = int(hour_str)
            if current_period == "ì˜¤ì „":
                result_set.add(0 if hour == 12 else hour)
            else:
                result_set.add(12 if hour == 12 else hour + 12)
        except: continue
    return result_set

def format_time_text(hour):
    if hour == 0: return "ì˜¤ì „ 12ì‹œ"
    elif hour < 12: return f"ì˜¤ì „ {hour}ì‹œ"
    elif hour == 12: return "ì˜¤í›„ 12ì‹œ"
    else: return f"ì˜¤í›„ {hour - 12}ì‹œ"

# âš¡ï¸ ì´ˆê´‘ì† ë²”ìš© API ìŠ¤ìºë„ˆ (ë‹¬ë ¥ UI í˜¸í™˜ íŒ¨ì¹˜)
@st.cache_data(show_spinner=False)
def run_api_crawler(target_date_obj, selected_studios): # ë³€ìˆ˜ëª… ë³€ê²½!
    # ğŸŒŸ ì´ì œ ìŠ¤íŠ¸ë¦¼ë¦¿ ë‹¬ë ¥ì—ì„œ ê³ ë¥¸ 'ì§„ì§œ ë‚ ì§œ ê°ì²´'ê°€ ë°”ë¡œ ë“¤ì–´ì˜´
    year = target_date_obj.year
    month = target_date_obj.month
    
    # ì„ íƒí•œ ë‚ ì§œê°€ í¬í•¨ëœ ë‹¬ì˜ ì²«ë‚ ê³¼ ë§ˆì§€ë§‰ ë‚ ì„ ê³„ì‚° (ë‹¤ìŒ ë‹¬ì„ ê³¨ë¼ë„ ì™„ë²½ ì‘ë™!)
    last_day = calendar.monthrange(year, month)[1]
    start_time_str = f"{year}-{month:02d}-01T00:00:00"
    end_time_str = f"{year}-{month:02d}-{last_day}T23:59:59"

    GRAPHQL_QUERY = """query hourlySchedule($scheduleParams: ScheduleParams) {\n  schedule(input: $scheduleParams) {\n    bizItemSchedule {\n      hourly {\n        unitStartDateTime\n        unitStartTime\n        unitBookingCount\n        unitStock\n        stock\n        bookingCount\n        isUnitSaleDay\n        isUnitBusinessDay\n      }\n    }\n  }\n}"""

    # ... (ì´ ì•„ë˜ forë¬¸ë¶€í„°ëŠ” ê¸°ì¡´ ì½”ë“œì™€ ì™„ì „íˆ ë™ì¼!) ...
    final_data = []
    for studio_name in selected_studios:
        if studio_name not in STUDIO_DB: continue
        for room in STUDIO_DB[studio_name]:
            url = room["url"]
            try:
                biz_id = url.split("bizes/")[1].split("/")[0]
                item_id = url.split("items/")[1].split("?")[0]
            except: continue

            headers = {"User-Agent": "Mozilla/5.0", "Content-Type": "application/json", "Referer": url}
            payload = {
                "operationName": "hourlySchedule",
                "variables": {
                    "scheduleParams": {
                        "businessTypeId": 10, "businessId": biz_id, "bizItemId": item_id,
                        "startDateTime": start_time_str, "endDateTime": end_time_str,
                        "fixedTime": True, "includesHolidaySchedules": True
                    }
                },
                "query": GRAPHQL_QUERY
            }

            try:
                response = requests.post("https://m.booking.naver.com/graphql", json=payload, headers=headers)
                # ğŸŒŸ ì—¬ê¸°ì— ìœ„ì¹˜(lat, lon) ì •ë³´ë„ ê°™ì´ ì €ì¥í•´ ë‘¬ì•¼ ë‚˜ì¤‘ì— ì§€ë„ì— ì°ì„ ìˆ˜ ìˆì–´!
                result = {"í•©ì£¼ì‹¤ ì´ë¦„": room['name'], "ìƒíƒœ": "âŒ ë§ˆê°", "ì˜ˆì•½ ê°€ëŠ¥ ì‹œê°„": "-", "ì˜ˆì•½ë§í¬": url, "lat": room['lat'], "lon": room['lon']}
                
                if response.status_code == 200:
                    data = response.json()
                    hourly_slots = data.get('data', {}).get('schedule', {}).get('bizItemSchedule', {}).get('hourly', [])
                    available_times = []
                    
                    for slot in hourly_slots:
                        start_time_str_raw = slot.get('unitStartTime', '')
                        if not start_time_str_raw: continue
                        
                        try:
                            date_part = start_time_str_raw.split()[0] 
                            year, month, day = map(int, date_part.split('-'))
                            slot_date_obj = datetime.date(year, month, day)
                            
                            if slot_date_obj != target_date_obj: continue
                            
                            stock = int(slot.get('unitStock', slot.get('stock', 0)))
                            booked = int(slot.get('unitBookingCount', slot.get('bookingCount', 0)))
                            is_sale = slot.get('isUnitSaleDay', True) and slot.get('isUnitBusinessDay', True)
                            
                            if stock > booked and is_sale:
                                time_part = start_time_str_raw.split()[-1]
                                hour = int(time_part.split(":")[0])
                                available_times.append(format_time_text(hour))
                        except: continue
                        
                    if available_times:
                        available_times = sorted(list(set(available_times)), key=lambda x: int(convert_to_24h_set(x).copy().pop()) if convert_to_24h_set(x) else 0)
                        result["ìƒíƒœ"] = "âœ… ì˜ˆì•½ ê°€ëŠ¥"
                        result["ì˜ˆì•½ ê°€ëŠ¥ ì‹œê°„"] = ", ".join(available_times)
                
                final_data.append(result)
            except: 
                result["ìƒíƒœ"] = "âš ï¸ íƒìƒ‰ ì‹¤íŒ¨"
                final_data.append(result)
            
    return pd.DataFrame(final_data)

# ==========================================
# ğŸ¨ ì›¹ì‚¬ì´íŠ¸ ë©”ì¸ í™”ë©´
# ==========================================
st.title("ğŸ¸ í™ëŒ€ í•©ì£¼ì‹¤ ì‹¹ì“¸ì´ íƒìƒ‰ê¸° (Map ì—ë””ì…˜)")
st.write("ë¬´ê±°ìš´ í¬ë¡¬ ëŒ€ì‹ , ë„¤ì´ë²„ ì„œë²„ì˜ ë’·ë¬¸ì„ ë‹¤ì´ë ‰íŠ¸ë¡œ í„¸ì–´ì˜µë‹ˆë‹¤! ğŸš€")

user_studios = st.multiselect(
    "ğŸ¯ íƒ€ê²Ÿ í•©ì£¼ì‹¤ ì„ íƒ", 
    options=list(STUDIO_DB.keys()), 
    default=["ê·¸ë¼ìš´ë“œí•©ì£¼ì‹¤ ë³¸ì ", "í˜¸ë‘ì´í•©ì£¼ì‹¤"]
)
st.divider()

col1, col2 = st.columns([1, 2])
with col1: 
    # ğŸŒŸ ë‹¬ë ¥ ìœ„ì ¯ìœ¼ë¡œ êµì²´! (min_valueë¥¼ ì˜¤ëŠ˜ë¡œ ì„¤ì •í•´ì„œ ì§€ë‚˜ê°„ ê³¼ê±°ëŠ” ì„ íƒ ë¶ˆê°€ëŠ¥í•˜ê²Œ ë§‰ìŒ)
    user_date = st.date_input(
        "ğŸ“… ì–¸ì œ í•©ì£¼í• ë˜?", 
        value=datetime.date.today(), 
        min_value=datetime.date.today(),
        format="YYYY.MM.DD"
    )

with col2: 
    time_range = st.slider("â° ëª‡ ì‹œë¶€í„° ëª‡ ì‹œ ì‚¬ì´ì— í•©ì£¼í• ë˜?", 0, 24, (16, 20), 1)

start_time, end_time = time_range
required_times = set(range(start_time, end_time))

if st.button("ğŸš€ ê´‘ì† ì‹¹ì“¸ì´ ì‹œì‘!", key="main_btn"):
    if not user_studios: 
        st.warning("âš ï¸ í•©ì£¼ì‹¤ì„ ì„ íƒí•´ì£¼ì„¸ìš”!")
        st.stop()

    # ğŸŒŸ ë‚ ì§œë¥¼ ì˜ˆì˜ê²Œ '02ì›” 18ì¼' í˜•íƒœë¡œ ì¶œë ¥
    display_date = user_date.strftime("%mì›” %dì¼")
    with st.spinner(f'{display_date} ìŠ¤ì¼€ì¤„ í„¸ì–´ì˜¤ëŠ” ì¤‘... ë°´ë“œë§¨ì€ ë‹¬ë¦°ë‹¤ ğŸƒâ€â™‚ï¸'):
        # ë°”ë€ ë³€ìˆ˜(user_date) ê·¸ëŒ€ë¡œ í•¨ìˆ˜ì— ë˜ì§€ë©´ ë!
        raw_df = run_api_crawler(user_date, tuple(user_studios)) 
        
    # ... (ì´ ì•„ë˜ í•„í„°ë§ ë° ì§€ë„ ì¶œë ¥ ë¡œì§ì€ ê¸°ì¡´ ì½”ë“œì™€ ì™„ì „íˆ ë™ì¼!) ...
    filtered_list = []
    for _, row in raw_df.iterrows():
        if row["ìƒíƒœ"] == "âœ… ì˜ˆì•½ ê°€ëŠ¥":
            available_set = convert_to_24h_set(row["ì˜ˆì•½ ê°€ëŠ¥ ì‹œê°„"])
            matching = required_times & available_set
            if matching:
                filtered_list.append({
                    "í•©ì£¼ì‹¤ ì´ë¦„": row["í•©ì£¼ì‹¤ ì´ë¦„"], 
                    "ğŸ¸ ê²¹ì¹˜ëŠ” ì‹œê°„": f"{sorted(list(matching))}ì‹œ", 
                    "ì›ë³¸ ë°ì´í„°": row["ì˜ˆì•½ ê°€ëŠ¥ ì‹œê°„"], 
                    "ë°”ë¡œê°€ê¸°": row["ì˜ˆì•½ë§í¬"],
                    "lat": row["lat"], # ğŸŒŸ ì§€ë„ì— ì°ì„ ìœ„ë„
                    "lon": row["lon"]  # ğŸŒŸ ì§€ë„ì— ì°ì„ ê²½ë„
                })
    
    if filtered_list:
        st.success("ë°ì´í„° í›”ì³ì˜¤ê¸° ì™„ë£Œ! ë§ˆë£¨ë…¸ìš°ì¹˜ ìƒˆë””ìŠ¤í‹± ê°€ì!!")
        
        # ğŸ—ºï¸ ğŸŒŸ ëŒ€ë§ì˜ ì§€ë„ ì‹œê°í™” ë¶€ë¶„ ğŸŒŸ ğŸ—ºï¸
        st.subheader("ğŸ—ºï¸ ë‚´ ì¡°ê±´ì— ë§ëŠ” í•©ì£¼ì‹¤ ìœ„ì¹˜ í™•ì¸í•˜ê¸°")
        
        # 1. ì§€ë„ì˜ ì¤‘ì‹¬ì  ì¡ê¸°
        center_lat = filtered_list[0]["lat"]
        center_lon = filtered_list[0]["lon"]
        m = folium.Map(location=[center_lat, center_lon], zoom_start=15)

        # 2. ğŸŒŸ í•µì‹¬ íŒ¨ì¹˜: ê°™ì€ ìœ„ì¹˜(ìœ„ë„, ê²½ë„)ì— ìˆëŠ” ë°©ë“¤ì„ í•˜ë‚˜ë¡œ ë¬¶ê¸°!
        location_groups = {}
        for room in filtered_list:
            lat = room["lat"]
            lon = room["lon"]
            room_name = room["í•©ì£¼ì‹¤ ì´ë¦„"]
            times = room["ğŸ¸ ê²¹ì¹˜ëŠ” ì‹œê°„"]

            # STUDIO_DBë¥¼ ë’¤ì ¸ì„œ 'ê·¸ë¼ìš´ë“œí•©ì£¼ì‹¤ ë³¸ì ' ê°™ì€ ì§„ì§œ ì§€ì ëª… ì°¾ê¸°
            studio_name = "í•©ì£¼ì‹¤"
            for s_name, r_list in STUDIO_DB.items():
                if any(r["name"] == room_name for r in r_list):
                    studio_name = s_name
                    break

            coord = (lat, lon)
            if coord not in location_groups:
                location_groups[coord] = {
                    "studio_name": studio_name,
                    "rooms_html": "" # ì—¬ê¸°ì— ë°© ëª©ë¡ì„ í…ìŠ¤íŠ¸ë¡œ ê³„ì† ë”í•  ê±°ì„
                }
            
            # ë°© ì´ë¦„ê³¼ ì‹œê°„ì„ ì˜ˆìœ ë¦¬ìŠ¤íŠ¸ <li> íƒœê·¸ë¡œ ì°©ì°© ìŒ“ê¸°
            location_groups[coord]["rooms_html"] += f"<li style='margin-bottom: 3px;'><b>{room_name}</b> : {times}</li>"

        # 3. ë¬¶ì–´ë‘” ë°ì´í„°ë¥¼ ë°”íƒ•ìœ¼ë¡œ ì§€ë„ì— ì§€ì ë‹¹ ë”± '1ê°œì˜ í•€'ë§Œ ê½‚ê¸°
        for coord, data in location_groups.items():
            studio_name = data["studio_name"]

            # íŒì—…(ë§í’ì„ )ì— ë“¤ì–´ê°ˆ ê¹”ë”í•œ HTML ì½”ë“œ
            popup_html = f"""
            <div style="min-width: 220px;">
                <h4 style="margin-bottom: 8px; color: #E91E63;">ğŸ¸ <b>{studio_name}</b></h4>
                <ul style="padding-left: 20px; margin-top: 0; font-size: 13px;">
                    {data["rooms_html"]}
                </ul>
            </div>
            """

            folium.Marker(
                [coord[0], coord[1]],
                popup=folium.Popup(popup_html, max_width=350),
                tooltip=studio_name, # ë§ˆìš°ìŠ¤ ì˜¬ë¦¬ë©´ 'ê·¸ë¼ìš´ë“œí•©ì£¼ì‹¤ ë³¸ì ' ë“±ì¥!
                icon=folium.Icon(color="red", icon="music", prefix='fa')
            ).add_to(m)

        # ìŠ¤íŠ¸ë¦¼ë¦¿ì— ì§€ë„ ì¶œë ¥! (ìƒˆë¡œê³ ì¹¨ ë°©ì§€ ì˜µì…˜ ìœ ì§€)
        st_folium(m, width=800, height=400, returned_objects=[])
        st.divider()

        # ê¸°ì¡´ í‘œ ì¶œë ¥
        st.subheader("ğŸ‰ ì°¾ì•˜ë‹¤! ì°¢ì„ ë°©!")
        # ì§€ë„ì—ëŠ” ì¢Œí‘œë¥¼ ì¼ìœ¼ë‹ˆ, í‘œì— ë³´ì—¬ì¤„ ë•ŒëŠ” í—·ê°ˆë¦¬ì§€ ì•Šê²Œ ì¢Œí‘œ ì»¬ëŸ¼ì„ ë¹¼ê³  ì¶œë ¥
        df_display = pd.DataFrame(filtered_list).drop(columns=["lat", "lon"])
        st.dataframe(df_display, use_container_width=True, column_config={"ë°”ë¡œê°€ê¸°": st.column_config.LinkColumn("ì˜ˆì•½ ë§í¬")})
        st.balloons()
    else:
        st.error(f"ğŸ˜­ {start_time}ì‹œ~{end_time}ì‹œ ì‚¬ì´ì—ëŠ” ë¹„ì–´ìˆëŠ” ë°©ì´ ì—†ì–´.")
        with st.expander("ì „ì²´ ê²€ìƒ‰ ê²°ê³¼ ë³´ê¸° (ë§ˆê° í¬í•¨)"):
            st.dataframe(raw_df.drop(columns=["lat", "lon"], errors='ignore'), use_container_width=True)
